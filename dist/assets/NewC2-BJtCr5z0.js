import{J as p,j as e,G as m,S as k,H as q,I as z,r as o,B as D,u as L}from"./index-BV4Nease.js";import{O as E,D as V,a as H,b as Y,B as te,c as re,R as ae,d as se}from"./BoxCover-D9rhDFlx.js";import{b as F}from"./baseaxios-CTVpXELN.js";import{A as ie,a as M,R as ne,S as oe,P as le}from"./StyledDataGrid-FNaFrEdc.js";import{F as $,c as v,a as A}from"./formik.esm-DZjldY3N.js";import{C as O}from"./ComDatePicker-DkX5OOTG.js";import{A as G}from"./AutocompleteForm-DM2Ck111.js";import{I as ce,F as R,B as T}from"./InputLabel-WUsojO3a.js";import{b as de}from"./TextField-BhRWA0TT.js";import{a as ue}from"./categoryC2-SXxx1T7y.js";import{a as xe}from"./newC1-BXl-CM4u.js";import"./FormControlLabel-M6Lp4kHF.js";import"./Skeleton-KZcenIcW.js";const Ce=async n=>{try{return(await F({method:"GET",url:"article-c2",params:n})).data}catch(r){return p.error(r.message),r}},he=async(n,r)=>{try{const a=await F({method:"POST",url:"article-c2",data:n,params:r});return a.data.status==200?p.success("Thêm tin C2 thành công!"):p.error("Đã có lỗi xảy ra!"),a.data}catch(a){return p.error(a.message),a}},ge=async(n,r)=>{try{const a=await F({method:"PUT",url:`article-c2/${r}`,data:n});return a.data.status==200?p.success("Câp nhật tin C2 thành công!"):p.error("Đã có lỗi xảy ra!"),a.data}catch(a){return p.error(a.message),a}},me=async n=>{try{const r=await F({method:"DELETE",url:`article-c2/${n}`});return r.data.status==200?p.success("Xóa tin C2 thành công!"):p.error("Đã có lỗi xảy ra"),r.data}catch(r){return p.error(r.message),r}},I={getNewsC2:Ce,AddNewsC2:he,EditNewsC2:ge,DeleteNewsC2:me},pe=({touched:n,data:r,handleBlur:a,errors:u,values:x,handleChange:C,valueLable:N,valueId:c,inputLable:y})=>e.jsx(e.Fragment,{children:e.jsxs(m,{item:!0,xs:12,children:[e.jsxs(k,{spacing:1,children:[e.jsx(ce,{htmlFor:c,children:y}),e.jsx(ie,{fullWidth:!0,sx:{"& .MuiAutocomplete-input":{padding:"0px !important"}},id:c,options:r,getOptionLabel:h=>h[N],value:(r==null?void 0:r.find(h=>h.ArticleCode===x[c]))||null,onBlur:a,onChange:(h,i)=>{C({target:{name:c,value:i?i[c]:""}})},renderInput:h=>e.jsx(de,{...h,variant:"outlined"})})]}),n[c]&&u[c]&&e.jsx(R,{error:!0,id:"standard-weight-helper-text-topic-id",children:u[c]})]})});function fe({open:n,setOpen:r,categoriesC2:a,articlesC1:u}){const x=q(),C=z(s=>s.organizationReducer),[N,c]=o.useState(null),y=s=>{c(s.format("YYYY-MM-DD"))},h=async s=>{console.log(s),(await I.AddNewsC2({ArticleUrl:s.ArticleUrl,EditContent:s.EditContent,Corrector:s.Corrector,CategoryId:s.CategoryId,CreateTime:N},{ArticleCode:s.ArticleCode})).status==200&&(x(M.status(!C.isFresh)),r(!1))},i=()=>{r(!1)};return e.jsx(e.Fragment,{children:e.jsx($,{initialValues:{ArticleUrl:"",EditContent:"",Corrector:"",CategoryId:"",ArticleCode:"",submit:null},validationSchema:v().shape({ArticleUrl:A().max(255).required("ArticleUrl is required"),EditContent:A().max(255).required("EditContent is required"),Corrector:A().max(255).required("Corrector is required"),CategoryId:A().max(255).required("CategoryId is required")}),onSubmit:h,children:({errors:s,handleBlur:d,handleChange:f,handleSubmit:w,isSubmitting:j,touched:g,values:b})=>e.jsx("form",{noValidate:!0,onSubmit:w,children:e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(k,{spacing:1,children:e.jsx(O,{lable:"Ngày đăng ",length:"100%",onDateChange:y})})}),e.jsx(E,{id:"ArticleUrl",lable:"Url bài báo",values:b,placeholder:"Nhập url",nameValue:"ArticleUrl",handleBlur:d,handleChange:f,touched:g,errors:s}),e.jsx(E,{id:"EditContent",lable:"Nội dung chỉnh sửa",values:b,placeholder:"Nhập nội dung",nameValue:"EditContent",handleBlur:d,handleChange:f,touched:g,errors:s}),e.jsx(E,{id:"Corrector",lable:"Người kiểm duyệt",values:b,placeholder:"Nhập tên người kiểm duyệt",nameValue:"Corrector",handleBlur:d,handleChange:f,touched:g,errors:s}),e.jsx(G,{touched:g,data:a,handleBlur:d,errors:s,values:b,handleChange:f,inputLable:"Danh mục tin C2",valueId:"CategoryId",valueLable:"CategoryName"}),e.jsx(pe,{touched:g,data:u,handleBlur:d,errors:s,values:b,handleChange:f,inputLable:"Tin C1",valueId:"ArticleCode",valueLable:"ArticleName"}),e.jsx(m,{item:!0,xs:12,sx:{mt:-1}}),s.submit&&e.jsx(m,{item:!0,xs:12,children:e.jsx(R,{error:!0,children:s.submit})}),e.jsx(m,{item:!0,xs:12,children:e.jsxs(D,{style:{float:"right"},children:[e.jsx(T,{disableElevation:!0,disabled:j,size:"small",variant:"contained",color:"primary",onClick:i,children:"Cancel"}),e.jsx(T,{disableElevation:!0,disabled:j,size:"small",type:"submit",variant:"contained",color:"primary",sx:{marginLeft:"10px"},children:"Ok"})]})})]})})})})}function je({open:n,setOpen:r,categoriesC2:a,articlesC1:u}){const x=L(),C=()=>{r(!1)};return e.jsx(o.Fragment,{children:e.jsxs(V,{open:n,onClose:C,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",sx:{"& .MuiDialogTitle-root":{background:`${x.palette.secondary[200]}`,marginBottom:"5px"}},children:[e.jsx(H,{id:"alert-dialog-title",sx:{fontSize:"16px",fontWeight:"Bold",lineHeight:"24px"},children:"Thêm tin C2"}),e.jsx(Y,{children:e.jsx(fe,{open:n,setOpen:r,categoriesC2:a,articlesC1:u})})]})})}function ye({setOpenEdit:n,categoriesC2:r,newC2:a}){const u=q(),x=z(i=>i.organizationReducer),[C,N]=o.useState(null),c=i=>{N(i.format("YYYY-MM-DD"))},y=async i=>{(await I.EditNewsC2({ArticleUrl:i.ArticleUrl,EditContent:i.EditContent,Corrector:i.Corrector,CategoryId:i.CategoryId,CreateTime:C||(a==null?void 0:a.CreateTime)},a.id)).status==200&&(u(M.status(!x.isFresh)),n(!1))},h=()=>{n(!1)};return e.jsx(e.Fragment,{children:e.jsx($,{initialValues:{ArticleUrl:a.ArticleUrl,EditContent:"",Corrector:"",CategoryId:a.CategoryId,submit:null},validationSchema:v().shape({ArticleUrl:A().max(255).required("ArticleUrl is required"),EditContent:A().max(255).required("EditContent is required"),Corrector:A().max(255).required("Corrector is required"),CategoryId:A().max(255).required("CategoryId is required")}),onSubmit:y,children:({errors:i,handleBlur:s,handleChange:d,handleSubmit:f,isSubmitting:w,touched:j,values:g})=>e.jsx("form",{noValidate:!0,onSubmit:f,children:e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(k,{spacing:1,children:e.jsx(O,{lable:"Ngày tạo tin",length:"100%",onDateChange:c,valueDefault:a==null?void 0:a.CreateTime})})}),e.jsx(E,{id:"ArticleUrl",lable:"Url bài báo",values:g,placeholder:"Nhập url",nameValue:"ArticleUrl",handleBlur:s,handleChange:d,touched:j,errors:i}),e.jsx(E,{id:"EditContent",lable:"Nội dung chỉnh sửa",values:g,placeholder:"Nhập nội dung",nameValue:"EditContent",handleBlur:s,handleChange:d,touched:j,errors:i}),e.jsx(E,{id:"Corrector",lable:"Người kiểm duyệt",values:g,placeholder:"Nhập tên người kiểm duyệt",nameValue:"Corrector",handleBlur:s,handleChange:d,touched:j,errors:i}),e.jsx(G,{touched:j,data:r,handleBlur:s,errors:i,values:g,handleChange:d,inputLable:"Danh mục tin C2",valueId:"CategoryId",valueLable:"CategoryName"}),e.jsx(m,{item:!0,xs:12,sx:{mt:-1}}),i.submit&&e.jsx(m,{item:!0,xs:12,children:e.jsx(R,{error:!0,children:i.submit})}),e.jsx(m,{item:!0,xs:12,children:e.jsxs(D,{style:{float:"right"},children:[e.jsx(T,{disableElevation:!0,disabled:w,size:"small",variant:"contained",color:"primary",onClick:h,children:"Cancel"}),e.jsx(T,{disableElevation:!0,disabled:w,size:"small",type:"submit",variant:"contained",color:"primary",sx:{marginLeft:"10px"},children:"Ok"})]})})]})})})})}function be({openEdit:n,setOpenEdit:r,categoriesC2:a,newC2:u}){const x=L(),C=()=>{r(!1)};return e.jsx(o.Fragment,{children:e.jsxs(V,{open:n,onClose:C,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",sx:{"& .MuiDialogTitle-root":{background:`${x.palette.secondary[200]}`,marginBottom:"5px"}},children:[e.jsx(H,{id:"alert-dialog-title",sx:{fontSize:"16px",fontWeight:"Bold",lineHeight:"24px"},children:"Cập nhật tin C2"}),e.jsx(Y,{children:e.jsx(ye,{setOpenEdit:r,categoriesC2:a,newC2:u})})]})})}function Ae(){const[n,r]=o.useState(!1),a=q(),u=z(t=>t.organizationReducer),[x,C]=o.useState([]),[N,c]=o.useState({}),[y,h]=o.useState([]),[i,s]=o.useState([]),d=async(t,l)=>{const S=await I.getNewsC2({page:t,size:l});C(S.result.rows)};o.useEffect(()=>{d(0,10)},[u.isFresh]),o.useEffect(()=>{(async()=>{const l=await xe.getNewC1({size:100});s(l.result.rows)})()},[]),o.useEffect(()=>{(async()=>{const l=await ue.getCategoryC2({size:100});h(l.result.rows)})()},[]);const[f,w]=o.useState(1),[j,g]=o.useState(10),[b,W]=o.useState([]),X=async()=>{var t,l;(t=b[0])!=null&&t.id?(await I.DeleteNewsC2((l=b[0])==null?void 0:l.id)).status==200&&a(M.status(!u.isFresh)):p.error("Chọn kênh để xóa!")},J=t=>{c(t),r(!n)},U=x==null?void 0:x.map((t,l)=>{var S;return{STT:(f-1)*j+l+1,ArticleCode:t==null?void 0:t.ArticleCode,ArticleC1Id:t==null?void 0:t.ArticleC1Id,ArticleUrl:t==null?void 0:t.ArticleUrl,edithistories:t==null?void 0:t.edithistories,ArticleC1:(S=t==null?void 0:t.ArticleC1)==null?void 0:S.ArticleName,Category:t==null?void 0:t.Category.CategoryName,CategoryId:t==null?void 0:t.CategoryId,CreateTime:t==null?void 0:t.CreateTime,id:t==null?void 0:t.id}}),K=[{field:"STT",headerName:"STT",flex:.2},{field:"ArticleCode",headerName:"Mã tin",flex:1},{field:"ArticleUrl",headerName:"Url tin",flex:1},{field:"ArticleC1",headerName:"Tin C1",flex:1},{field:"Category",headerName:"Danh mục",flex:1},{field:"CreateTime",headerName:"Thời gian tạo",flex:1},{field:"action",align:"left",headerName:"Tác vụ",flex:.5,renderCell:t=>e.jsx(e.Fragment,{children:e.jsx(se,{type:"edit",onClick:()=>J(t.row)})})}],Q=(t,l)=>{w(l),d(l-1,10)},[B,P]=o.useState(!1),Z=()=>{P(!B)},_=L();return e.jsxs(te,{children:[e.jsxs(re,{children:[e.jsx(D,{}),e.jsxs(D,{children:[e.jsx(T,{component:"label",onClick:Z,sx:{whiteSpace:"nowrap",padding:"5px 15px 5px 15px"},role:void 0,variant:"contained",tabIndex:-1,startIcon:e.jsx(ae,{}),children:"Thêm tin"}),e.jsx(T,{component:"label",onClick:X,sx:{whiteSpace:"nowrap",padding:"5px 15px 5px 15px",marginLeft:"5px"},role:void 0,variant:"contained",tabIndex:-1,startIcon:e.jsx(ne,{}),children:"Xóa"})]})]}),U?e.jsx(oe,{rows:U,columns:K,disableColumnMenu:!0,checkboxSelection:!0,rowHeight:40,columnHeaderHeight:45,autoHeight:!0,sx:{border:2,borderColor:_.palette.secondary.light},onRowSelectionModelChange:t=>{const l=new Set(t),S=U.filter(ee=>l.has(ee.id.toString()));W(S)}}):"Loading",e.jsx(D,{sx:{display:"flex",justifyContent:"center",marginTop:"10px",paddingBottom:"10px"},children:e.jsx(le,{count:10,color:"primary",onChange:Q})}),e.jsx(be,{openEdit:n,setOpenEdit:r,categoriesC2:y,newC2:N}),e.jsx(je,{open:B,setOpen:P,categoriesC2:y,articlesC1:i})]})}const Re=()=>e.jsx(e.Fragment,{children:e.jsx(Ae,{})});export{Re as default};
